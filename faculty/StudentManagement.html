<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Management Dashboard</title>
  <link rel="stylesheet" href="StudentManagement.css">
</head>

<header>
  <nav style="width: 100vw; background: #111827; color: #fff; padding: 0; height: 60px; display: flex; align-items: center; position: fixed; top: 0; left: 0; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <div style="display: flex; align-items: center; height: 100%; width: 100%; max-width: 1400px; margin: 0 auto;">
      <img src="imgs and vids/logo.svg" alt="Logo" style="height: 38px; margin-left: 30px; margin-right: 18px;">
      <span style="font-size: 22px; font-weight: bold; letter-spacing: 1px;">EduManage</span>
      <div style="margin-left: auto; display: flex; align-items: center; gap: 30px; margin-right: 40px;">
        <a href="/home/home.html" style="color: #fff; text-decoration: none; font-size: 16px;">Home</a>
        <a href="StudentManagement.html" style="color: #fff; text-decoration: none; font-size: 16px;">Students</a>
        <a href="/faculty/faculty.html" style="color: #fff; text-decoration: none; font-size: 16px;">Faculty</a>
        <a href="login.html" style="color: #fff; text-decoration: none; font-size: 16px;">Logout</a>
      </div>
    </div>
  </nav>
</header>

<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>EduManage</h2>
    <ul class="menu">
      <li class="active">Student</li>
      <a href="/faculty/faculty.html">Add Student</a>
    </ul>
    
  </div>

  <!-- Main -->
  <div class="main">
    <div class="header">
      <h1>Student Management</h1>
      <a style="color: white; padding: 10px 20px; background-color: rgb(0, 0, 0); border-radius: 10px; text-decoration: none; font-weight: bolder;" href="faculty.html"> +&nbsp;&nbsp;&nbsp;Add Student</a>
    </div>

    <div class="filters">
      <input type="text" id="search" placeholder="Search students...">
      <div>
        <select id="gradeFilter">
          <option value="All">All Grades</option>
          <option value="11th Grade">11th Grade</option>
          <option value="12th Grade">12th Grade</option>
        </select>
        <select id="statusFilter">
          <option value="All">All Status</option>
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
      </div>
    </div>

    <!-- Horizontal Student Records -->
    <div id="studentDetails"></div>
  </div>

  <!-- Firebase Modular SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9C1j6rc8QicmusZ3_tTlCMxfnqaXuYrg",
      authDomain: "hackathon-24389.firebaseapp.com",
      databaseURL: "https://hackathon-24389-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "hackathon-24389",
      storageBucket: "hackathon-24389.firebasestorage.app",
      messagingSenderId: "223352153020",
      appId: "1:223352153020:web:4033ee61bbd488830e81b9",
      measurementId: "G-LVG5GVVE91"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const studentDetails = document.getElementById("studentDetails");
    const searchInput = document.getElementById("search");
    const gradeFilter = document.getElementById("gradeFilter");
    const statusFilter = document.getElementById("statusFilter");

    // Function to render students
    function renderStudents(snapshot) {
      studentDetails.innerHTML = "";
      snapshot.forEach(childSnapshot => {
        const student = childSnapshot.val();

        const detail = document.createElement("div");
        detail.classList.add("student-detail");
        detail.innerHTML = `
          <h3>${student.firstName || ""} ${student.lastName || ""}</h3>
          <p><strong>Email:</strong> ${student.email || "N/A"}</p>
          <p><strong>Phone:</strong> ${student.phone || "N/A"}</p>
          <p><strong>Grade:</strong> ${student.grade || "N/A"} | <strong>GPA:</strong> ${student.gpa || "N/A"}</p>
          <p><strong>Status:</strong> ${student.status || "N/A"}</p>
          <p><strong>DOB:</strong> ${student.dob || "N/A"} | <strong>Admission:</strong> ${student.admissionDate || "N/A"}</p>
          <p><strong>Address:</strong> ${student.address || "N/A"}</p>
          <p><strong>Emergency:</strong> ${student.emergency || "N/A"}</p>
          <p><strong>Subjects:</strong> ${(student.subjects || []).join(", ")}</p>
          <p><strong>Activities:</strong> ${(student.activities || []).join(", ")}</p>
        `;
        studentDetails.appendChild(detail);
      });
    }

    // Fetch all students
    const studentsRef = ref(db, "students");
    onValue(studentsRef, (snapshot) => {
      renderStudents(snapshot);
    });

    // Simple search & filter (client-side)
    function applyFilters(snapshot) {
      studentDetails.innerHTML = "";
      snapshot.forEach(childSnapshot => {
        const student = childSnapshot.val();
        const fullName = (student.firstName + " " + student.lastName).toLowerCase();

        const matchesSearch = fullName.includes(searchInput.value.toLowerCase());
        const matchesGrade = (gradeFilter.value === "All" || student.grade === gradeFilter.value);
        const matchesStatus = (statusFilter.value === "All" || student.status === statusFilter.value);

        if (matchesSearch && matchesGrade && matchesStatus) {
          const detail = document.createElement("div");
          detail.classList.add("student-detail");
          detail.innerHTML = `
            <h3>${student.firstName || ""} ${student.lastName || ""}</h3>
            <p><strong>Email:</strong> ${student.email || "N/A"}</p>
            <p><strong>Phone:</strong> ${student.phone || "N/A"}</p>
            <p><strong>Grade:</strong> ${student.grade || "N/A"} | <strong>GPA:</strong> ${student.gpa || "N/A"}</p>
            <p><strong>Status:</strong> ${student.status || "N/A"}</p>
            <p><strong>DOB:</strong> ${student.dob || "N/A"} | <strong>Admission:</strong> ${student.admissionDate || "N/A"}</p>
            <p><strong>Address:</strong> ${student.address || "N/A"}</p>
            <p><strong>Emergency:</strong> ${student.emergency || "N/A"}</p>
            <p><strong>Subjects:</strong> ${(student.subjects || []).join(", ")}</p>
            <p><strong>Activities:</strong> ${(student.activities || []).join(", ")}</p>
          `;
          studentDetails.appendChild(detail);
        }
      });
    }

    // Add event listeners for search and filters
    onValue(studentsRef, (snapshot) => {
      searchInput.addEventListener("input", () => applyFilters(snapshot));
      gradeFilter.addEventListener("change", () => applyFilters(snapshot));
      statusFilter.addEventListener("change", () => applyFilters(snapshot));
    });

  </script>
</body>
</html>
